<model-viewer id="main-viewer" 
    camera-controls 
    auto-rotate 
    shadow-intensity="1" 
    environment-image="neutral" 
    ar 
    ar-modes="webxr scene-viewer quick-look"
    loading="lazy"
    poster="loading_preview.png"> <button slot="ar-button" style="background-color: white; border-radius: 8px; border: none; position: absolute; bottom: 16px; right: 16px; padding: 10px;">
        ðŸ‘‹ View in AR
    </button>
</model-viewer>

<script>
    // 1. Use a more robust pathing system for GitHub Pages subdirectories
    const BASE_PATH = window.location.pathname.includes('github.io') ? './' : '';
    const JSON_URL = `${BASE_PATH}models.json`; 

    async function initializeApp() { 
        try {
            const response = await fetch(JSON_URL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            modelData = await response.json();
            
            modelSelect.innerHTML = '';  
            modelData.forEach((m, index) => { 
                const opt = document.createElement('option'); 
                opt.value = index; 
                opt.textContent = m.name; 
                modelSelect.appendChild(opt); 
            }); 
            
            // Default load
            if(modelData.length > 0) updateAsset(0);
            
            bootLogs.innerText = "SYSTEMS ONLINE";
            entryBtn.style.display = "block";
        } catch (error) {
            console.error("Init Error:", error);
            bootLogs.innerText = "OFFLINE: CHECK JSON/GITHUB PATHS";
            bootLogs.style.color = "#ff4444";
        }
    } 

    function updateAsset(index) { 
        const asset = modelData[index]; 
        
        // Ensure paths are relative to the root for GH Pages compliance
        const glbPath = `models/${asset.file}.glb`;
        const usdzPath = asset.usdz_file ? `models/${asset.usdz_file}.usdz` : '';

        viewer.src = glbPath; 
        
        if (usdzPath) { 
            viewer.setAttribute('ios-src', usdzPath); 
        } else {
            viewer.removeAttribute('ios-src'); // Prevents iOS from trying to load previous model's AR
        }
         
        document.getElementById('asset-title').textContent = asset.name; 
        document.getElementById('spec-base').textContent = asset.base || 'N/A'; 
        document.getElementById('spec-payload').textContent = asset.payload || 'N/A'; 
        document.getElementById('spec-desc').textContent = asset.description || 'No description available.'; 
    } 
</script>
